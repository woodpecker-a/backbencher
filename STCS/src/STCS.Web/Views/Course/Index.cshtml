@model CourseListModel
@{
    ViewData["Title"] = "Course";
}
@section Styles
{
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
}
<div class="row">
    <div class="col-sm-12">
        <div class="card">
            <div class="card-header">
                <h5>Course List</h5>
                <span>The list of courses with Ajax-powered DataTables</span>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="display datatables" id="courses">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Course Code</th>
                                <th>Start Date</th>
                                <th>OIC</th>
                                <th>JIC</th>
                                <th>Total Students</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>Course Name</th>
                                <th>Course Code</th>
                                <th>Start Date</th>
                                <th>OIC</th>
                                <th>JIC</th>
                                <th>Total Students</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Delete Confirmation -->
<div class="modal fade" id="modal-default" tabindex="-1" role="dialog" aria-labelledby="modal-default-label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-default-label">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this record?</p>
            </div>
            <div class="modal-footer">
                <form id="deleteForm" method="post">
                    <input type="hidden" id="deleteId" name="id" />
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteButton">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
    <script>
        $(function () {
            // Initialize DataTable
            $('#courses').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "@Url.Action("GetCourses", "Course")",  // Ensure the correct action and controller here
                    "type": "POST"
                },
                "columnDefs": [
                    {
                        "orderable": false,
                        "targets": 7,
                        "render": function (data, type, row) {
                            return `
                                <button type="button" class="btn btn-info btn-sm" onclick="window.location.href='/course/edit/${data}'">
                                    <i class="fas fa-pencil-alt"></i> Edit
                                </button>
                                <button type="button" class="btn btn-danger btn-sm show-bs-modal" data-id='${data}'>
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            `;
                        }
                    }
                ]
            });

            // Show the delete modal
            $('#courses').on('click', '.show-bs-modal', function () {
                var id = $(this).data("id");
                var modal = $("#modal-default");
                modal.find('.modal-body p').text('Are you sure you want to delete this record?');
                $("#deleteId").val(id);
                modal.modal('show');
            });

            // Submit the delete form
            $("#deleteButton").click(function () {
                var id = $("#deleteId").val();
                $.ajax({
                    url: '/course/delete/' + id,
                    type: 'POST',
                    success: function () {
                        // Reload the DataTable
                        $('#courses').DataTable().ajax.reload();
                        // Close the modal
                        $('#modal-default').modal('hide');
                    },
                    error: function (xhr, status, error) {
                        alert('An error occurred: ' + error);
                    }
                });
            });
        });
    </script>
}
